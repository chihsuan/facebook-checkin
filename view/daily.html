<html>
  <head>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
     <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
     <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
     <script src="leaflet-heat.js"></script>
     <style>
       body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
       }
       #mapid {
        height: 100%;
        width: 100%;
      }
       .date {
         position: absolute;
        left: 60px;
        top: 10px;
        z-index: 999;
        background: #fff;
        padding: 10px;
        border-radius: 5px;
      }
      </style>
  </head>
  <body>
     <div class="date"></div>
     <div id="mapid"></div>
   </body>
  <script>
    var mymap = L.map('mapid').setView([22.997, 120.2], 14);

    var googleStreet =  new L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3']
    });
    var googleHybrid = new L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
          maxZoom: 20,
          subdomains:['mt0','mt1','mt2','mt3']
    });

    //googleHybrid.addTo(mymap);
    googleStreet.addTo(mymap);
    L.control.layers({
      //"地球": googleHybrid,
      "地圖": googleStreet
      }).addTo(mymap);

    var heat = L.heatLayer([], {
        radius: 25,
        max: 2
    }).addTo(mymap);

    d3.json('../data/simplify_checkin_daily.json', function(data) {
      var latlng = [];
      data.forEach(function(d) {
        if (!d.visit)
          return;

        var visit = d.visit;
        //visit = d.visit/500;

        for (var i=0; i < visit; ++i) {
          latlng.push([d.latitude, d.longitude]);
        }
        var circle = L.circle([d.latitude, d.longitude], 10, {
          color: 'blue',
          fillColor: '#4AC3E7',
          fillOpacity: 0.5
        }).addTo(mymap);
        circle.bindPopup(d.name+'（'+d.visit+')');
      });

      heat.setLatLngs(latlng);
      console.log(data.length);
      document.querySelector('.date').innerHTML = data[0].date.substring(0, 10);
    });

  </script>
</html>
